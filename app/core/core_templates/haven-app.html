<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haven - Your Mental Wellness Companion</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Space+Mono:wght@400;700&family=DM+Serif+Display&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="animated-bg">
        <div class="floating-orb orb-1"></div>
        <div class="floating-orb orb-2"></div>
        <div class="floating-orb orb-3"></div>
    </div>

    <!-- Landing Screen -->
    <div class="screen active" id="landing">
        <div class="landing">
            <div class="hero-content">
                <h1 class="logo">Haven</h1>
                <p class="tagline">A warm space for your mind to rest</p>
                <button class="cta-button" onclick="startJourney()">Begin Your Journey</button>
            </div>
        </div>
    </div>

    <!-- Chat Screen -->
    <div class="screen" id="chat">
        <div class="chat-container">
            <div class="chat-header">
                <h2>Let's Talk</h2>
                <p>share what's on your mind, no pressure</p>
            </div>
            <div class="messages" id="messages">
                <div class="message bot">
                    <div class="message-avatar bot-avatar">üåô</div>
                    <div class="message-content">
                        <p>hey there. the world can be a lot sometimes. how are you holding up today?</p>
                    </div>
                </div>
            </div>
            <div class="input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="type anything..." onkeypress="handleEnter(event)">
                <button class="send-button" onclick="sendMessage()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="chatProgress" style="width: 20%"></div>
            </div>
        </div>
    </div>

    <!-- Bubble Popper Game -->
    <div class="screen" id="bubbleGame">
        <div class="game-container">
            <div class="game-header">
                <h2>What's Weighing on You?</h2>
                <p>tap the bubbles that feel heavy right now</p>
            </div>
            <div class="bubble-arena" id="bubbleArena"></div>
            <button class="cta-button" onclick="finishBubbleGame()">Continue</button>
        </div>
    </div>

    <!-- Mood Slider Game -->
    <div class="screen" id="moodGame">
        <div class="mood-slider-container">
            <div class="game-header">
                <h2>The Weather Inside</h2>
                <p>show me what the weather looks like inside your head right now</p>
            </div>
            <div class="landscape" id="landscape">
                <div class="landscape-sky" id="landscapeSky"></div>
                <div class="landscape-ground"></div>
                <div class="weather-elements" id="weatherElements">
                    <div class="sun" id="sun"></div>
                </div>
            </div>
            <input type="range" min="0" max="100" value="50" class="mood-slider" id="moodSlider">
            <div class="mood-labels">
                <span>Stormy</span>
                <span>Cloudy</span>
                <span>Sunny</span>
            </div>
            <br><br>
            <button class="cta-button" onclick="finishMoodGame()">Continue</button>
        </div>
    </div>

    <!-- Insight Card -->
    <div class="screen" id="insight">
        <div class="insight-container">
            <div class="insight-card">
                <span class="archetype-badge">The Navigator</span>
                <h2 class="insight-title">You're carrying the weight of everyone's expectations</h2>
                <p class="insight-description">
                    You're a guardian type‚Äîprotective, driven, but tired. You set incredibly high standards for yourself, 
                    and right now, it feels like you're constantly proving your worth. That's exhausting.
                </p>
                <p class="insight-description">
                    The good news? You're not alone in this. There are others who understand exactly what you're going through.
                </p>
                <button class="cta-button" onclick="showMatching()">Find My People</button>
            </div>
        </div>
    </div>

    <!-- Group Matching -->
    <div class="screen" id="matching">
        <div class="matching-container">
            <h2 style="font-family: var(--font-display); font-size: 42px; margin-bottom: 20px;">
                Finding Your Tribe
            </h2>
            <p style="font-size: 20px; color: var(--text-secondary); margin-bottom: 40px;">
                connecting you with people who get it...
            </p>
            
            <div class="connection-animation">
                <div class="dots-container">
                    <div class="connection-dot"></div>
                    <div class="connection-dot"></div>
                    <div class="connection-dot"></div>
                </div>
            </div>

            <div class="group-card">
                <h3 class="group-name">The Navigators</h3>
                <p class="group-description">
                    A supportive space for high-achievers dealing with career stress, imposter syndrome, 
                    and the pressure of constant performance. You all understand what it's like to feel 
                    like you're never quite enough.
                </p>
                <div class="group-stats">
                    <div class="stat">
                        <span>üë•</span>
                        <span>6-8 members</span>
                    </div>
                    <div class="stat">
                        <span>üìÖ</span>
                        <span>Weekly sessions</span>
                    </div>
                    <div class="stat">
                        <span>‚è∞</span>
                        <span>60 minutes</span>
                    </div>
                </div>
            </div>

            <button class="cta-button" onclick="showScheduling()">Join This Group</button>
        </div>
    </div>

    <!-- Scheduling -->
    <div class="screen" id="scheduling">
        <div class="schedule-container">
            <div class="chat-header">
                <h2>Pick Your Time</h2>
                <p>when works best for you?</p>
            </div>

            <div class="calendar-slots">
                <div class="time-slot" onclick="selectTimeSlot(this)">
                    <div style="font-weight: 600; margin-bottom: 5px;">Tuesday</div>
                    <div style="font-size: 14px; color: #718096;">6:00 PM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this)">
                    <div style="font-weight: 600; margin-bottom: 5px;">Wednesday</div>
                    <div style="font-size: 14px; color: #718096;">7:00 PM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this)">
                    <div style="font-weight: 600; margin-bottom: 5px;">Thursday</div>
                    <div style="font-size: 14px; color: #718096;">6:00 PM</div>
                </div>
                <div class="time-slot" onclick="selectTimeSlot(this)">
                    <div style="font-weight: 600; margin-bottom: 5px;">Saturday</div>
                    <div style="font-size: 14px; color: #718096;">10:00 AM</div>
                </div>
            </div>

            <div style="background: white; padding: 30px; border-radius: 20px; margin: 30px 0; box-shadow: 0 8px 30px rgba(0,0,0,0.06);">
                <h3 style="margin-bottom: 15px;">Session Details</h3>
                <p style="color: #718096; margin-bottom: 20px;">Group: The Navigators</p>
                <p style="color: #718096; margin-bottom: 20px;">Duration: 60 minutes</p>
                <p style="font-size: 24px; font-weight: 600; color: var(--accent-purple);">AED 120 / session</p>
            </div>

            <button class="cta-button" onclick="showPayment()">Continue to Payment</button>
        </div>
    </div>

    <!-- Payment (Mock) -->
    <div class="screen" id="payment">
        <div class="schedule-container">
            <div class="chat-header">
                <h2>Complete Booking</h2>
                <p>secure your spot</p>
            </div>

            <div style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.06); margin: 30px 0;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üí≥</div>
                    <h3 style="margin-bottom: 10px;">Payment Information</h3>
                    <p style="color: #718096;">Powered by Stripe (Sandbox Mode)</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">Card Number</label>
                    <input type="text" placeholder="4242 4242 4242 4242" style="width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Expiry</label>
                        <input type="text" placeholder="MM/YY" style="width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">CVC</label>
                        <input type="text" placeholder="123" style="width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px;">
                    </div>
                </div>

                <div style="background: #f7fafc; padding: 20px; border-radius: 12px; margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Session Cost</span>
                        <span style="font-weight: 600;">AED 120</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 2px solid #e2e8f0;">
                        <span style="font-weight: 600;">Total</span>
                        <span style="font-size: 20px; font-weight: 600; color: var(--accent-purple);">AED 120</span>
                    </div>
                </div>
            </div>

            <button class="cta-button" onclick="showDashboard()">Confirm & Pay</button>
        </div>
    </div>

    <!-- Therapist Dashboard -->
    <div class="screen" id="dashboard">
        <div class="dashboard-container">
            <div class="dashboard-header">
                <h1>Therapist Dashboard</h1>
                <p style="color: #718096; font-size: 18px;">Session: The Navigators ‚Ä¢ Tuesday, 6:00 PM</p>
            </div>

            <div class="dashboard-grid">
                <!-- Group Mood Heatmap -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Group Mood Today</h3>
                        <span style="font-size: 12px; color: #718096;">High Anxiety, Low Energy</span>
                    </div>
                    <div class="mood-heatmap">
                        <div class="heatmap-cell" style="background: #f093fb;">üò∞</div>
                        <div class="heatmap-cell" style="background: #667eea;">üòî</div>
                        <div class="heatmap-cell" style="background: #f093fb;">üòü</div>
                        <div class="heatmap-cell" style="background: #ed64a6;">üòì</div>
                        <div class="heatmap-cell" style="background: #667eea;">üòû</div>
                    </div>
                    <p style="color: #718096; font-size: 14px; margin-top: 15px;">
                        Today's theme: Performance pressure & burnout concerns
                    </p>
                </div>

                <!-- Participant Profiles -->
                <div class="dashboard-card" style="grid-column: span 2;">
                    <div class="card-header">
                        <h3 class="card-title">Participant Quick Cards</h3>
                    </div>
                    <ul class="participant-list">
                        <li class="participant-item">
                            <div class="participant-name">Mani ‚Ä¢ 22 ‚Ä¢ Student</div>
                            <div class="participant-trigger">
                                <strong>Primary concern:</strong> Coding bootcamp stress, family expectations<br>
                                <strong>Trigger:</strong> Failure, not meeting expectations<br>
                                <strong>Needs:</strong> Validation on hard work, permission to rest
                            </div>
                        </li>
                        <li class="participant-item">
                            <div class="participant-name">Sarah ‚Ä¢ 26 ‚Ä¢ Designer</div>
                            <div class="participant-trigger">
                                <strong>Primary concern:</strong> Career transition anxiety, imposter syndrome<br>
                                <strong>Trigger:</strong> Comparison with peers<br>
                                <strong>Needs:</strong> Confidence building, perspective on growth
                            </div>
                        </li>
                        <li class="participant-item">
                            <div class="participant-name">Alex ‚Ä¢ 24 ‚Ä¢ Engineer</div>
                            <div class="participant-trigger">
                                <strong>Primary concern:</strong> Burnout from startup culture<br>
                                <strong>Trigger:</strong> "Always-on" work culture<br>
                                <strong>Needs:</strong> Boundary setting strategies, work-life balance
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Session Brief -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title">Session Preparation</h3>
                    </div>
                    <p style="color: #718096; line-height: 1.8; margin-bottom: 20px;">
                        This group struggles with high self-expectations and fear of failure. 
                        Common themes include family pressure, career uncertainty, and the belief 
                        that rest equals weakness.
                    </p>
                    <button class="btn-secondary" onclick="downloadBrief()">
                        üìÑ Download Full Brief (PDF)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation between screens
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function startJourney() {
            showScreen('chat');
        }

        // Chat functionality
        let chatMessages = [
            { role: 'bot', text: 'hey there. the world can be a lot sometimes. how are you holding up today?' }
        ];
        let messageCount = 0;

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage('user', message);
                input.value = '';
                
                messageCount++;
                updateProgress();
                
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        removeTyping();
                        respondToUser(message);
                    }, 2000);
                }, 500);
            }
        }

        function addMessage(role, text) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${role}-avatar`;
            avatar.textContent = role === 'bot' ? 'üåô' : '‚ú®';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = `<p>${text}</p>`;
            
            if (role === 'user') {
                messageDiv.appendChild(content);
                messageDiv.appendChild(avatar);
            } else {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(content);
            }
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTyping() {
            const messagesDiv = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = `
                <div class="message-avatar bot-avatar">üåô</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function removeTyping() {
            const typing = document.getElementById('typing');
            if (typing) typing.remove();
        }

        function respondToUser(userMessage) {
            const responses = [
                "that sounds really heavy. i'm sorry you're dealing with that. how long has this been going on?",
                "i hear you. it sounds like you're carrying a lot of weight right now. what does a good day look like for you?",
                "thank you for sharing that with me. it takes courage to open up. what do you think you need most right now?",
                "i think i'm starting to understand what you're going through. let's try something different‚Äîsomething a bit more interactive. would that be okay?"
            ];
            
            if (messageCount < 4) {
                addMessage('bot', responses[messageCount - 1]);
            } else {
                addMessage('bot', responses[3]);
                setTimeout(() => {
                    showScreen('bubbleGame');
                    initBubbleGame();
                }, 2000);
            }
        }

        function updateProgress() {
            const progress = (messageCount / 4) * 100;
            document.getElementById('chatProgress').style.width = progress + '%';
        }

        // Bubble Game
        const stressors = [
            { text: 'Work', color: '#667eea', size: 100 },
            { text: 'Family', color: '#f093fb', size: 120 },
            { text: 'Money', color: '#4facfe', size: 90 },
            { text: 'Future', color: '#ed64a6', size: 110 },
            { text: 'Health', color: '#fee140', size: 95 },
            { text: 'Relationships', color: '#764ba2', size: 105 }
        ];

        function initBubbleGame() {
            const arena = document.getElementById('bubbleArena');
            arena.innerHTML = '';
            
            stressors.forEach((stressor, index) => {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = stressor.text;
                bubble.style.width = stressor.size + 'px';
                bubble.style.height = stressor.size + 'px';
                bubble.style.background = `linear-gradient(135deg, ${stressor.color}, ${adjustColor(stressor.color, 20)})`;
                bubble.style.left = Math.random() * (arena.offsetWidth - stressor.size) + 'px';
                bubble.style.top = Math.random() * (arena.offsetHeight - stressor.size) + 'px';
                bubble.style.animationDelay = index * 0.2 + 's';
                
                bubble.onclick = function() {
                    this.classList.add('popping');
                    setTimeout(() => this.remove(), 500);
                };
                
                arena.appendChild(bubble);
            });
        }

        function adjustColor(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1);
        }

        function finishBubbleGame() {
            showScreen('moodGame');
        }

        // Mood Slider
        const moodSlider = document.getElementById('moodSlider');
        if (moodSlider) {
            moodSlider.addEventListener('input', function() {
                updateLandscape(this.value);
            });
        }

        function updateLandscape(value) {
            const sky = document.getElementById('landscapeSky');
            const sun = document.getElementById('sun');
            
            if (value < 33) {
                // Stormy
                sky.style.background = 'linear-gradient(to bottom, #2d3561, #596275)';
                sun.style.opacity = '0';
            } else if (value < 66) {
                // Cloudy
                sky.style.background = 'linear-gradient(to bottom, #a8b5c8, #c9d6df)';
                sun.style.opacity = '0.3';
            } else {
                // Sunny
                sky.style.background = 'linear-gradient(to bottom, #4facfe, #87ceeb)';
                sun.style.opacity = '1';
            }
        }

        function finishMoodGame() {
            showScreen('insight');
        }

        function showMatching() {
            showScreen('matching');
        }

        function showScheduling() {
            showScreen('scheduling');
        }

        function selectTimeSlot(element) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function showPayment() {
            showScreen('payment');
        }

        function showDashboard() {
            showScreen('dashboard');
        }

        function downloadBrief() {
            alert('Therapist handoff PDF would download here (mock).\n\nWould contain:\n- Group profile & themes\n- Individual participant summaries\n- Key concerns & triggers\n- Recommended focus areas');
        }
    </script>
</body>
</html>